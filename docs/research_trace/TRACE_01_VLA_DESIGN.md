# Trace: VLA Toy 实验设计工程决策记录

> **背景**：本文档记录了 `vla_alignment_toy` 示例背后的工程决策过程，展示了如何将复杂的研究主题（VLA/多模态对齐）分解为可验证的工程任务。

## 1. 问题分解与技术选型

**目标**：在不训练大型模型的前提下验证多模态对齐能力（避免GPU依赖与复杂环境配置）。

**工程决策过程**：
1. **选项评估**：
   - **方案A：微调LLaVA模型** → **风险**：依赖GPU、大权重文件、复杂环境配置，难以在CI中复现
   - **方案B：使用预训练CLIP模型** → **风险**：适用于应用验证，但无法证明"训练/对齐"能力
   - **方案C：合成玩具数据集** → **优势**：可在CPU运行、零权重依赖、纯代码实现

2. **最终决策**：
   - 选择**合成玩具数据**方案：生成共享隐空间中的配对向量(v, t)，训练投影头恢复对齐关系
   - **权衡说明**：非真实数据，但明确标注为"Toy"示例，用于验证训练流程与消融实验框架，而非模型性能

## 2. 实验设计与消融验证

**目标**：展示模型架构对比能力（体现工程与研究严谨性）。

**实验设计逻辑**：
1. **核心问题**：验证最简单结构变化带来的性能差异
2. **技术假设**：若隐空间关系简单但有噪声，非线性头（MLP）应比线性头具有更好的对齐能力
3. **实现方案**：
   - **基线模型**：`LinearHead` (d_in → d_proj)
   - **对比模型**：`MLPHead` (d_in → hidden → d_proj)
   - **评估指标**：`retrieval@1`（批内检索正确率）

## 3. 指标标准化与输出定义

**目标**：建立可比较的评估基准，确保结果一致性。

**指标设计考虑**：
- **损失函数**：InfoNCE（标准对比损失），提供梯度信号但直观解释性有限
- **业务指标**："匹配准确率"作为可理解的评估标准
- **实现方案**：批内检索，对于批次大小$N$，检查每个$v_i$是否与对应的$t_i$最接近
- **输出架构**：记录`loss_start`、`loss_end`、`at1_start`、`at1_end`等关键指标，支持两种头的对比分析

## 4. 证据包定义与验证要求

**目标**：定义可验证实验成功执行的工程证据。

**证据包构成**：
- **环境指纹**：`env.json`，记录硬件环境与软件依赖（CPU配置等）
- **结构化结果**：`results.json`，遵循标准架构存储线性头与MLP头的量化指标
- **技术报告**：`report.md`，自动生成的Markdown格式总结表格

---

**交付产出**：基于此设计蓝图开发的 `examples/vla_alignment_toy` 示例代码。

